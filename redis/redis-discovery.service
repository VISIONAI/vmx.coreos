Description=Redis Discovery

Requires=etcd.service
Requires=redis.service

After=etcd.service
BindsTo=redis.service

[Service]
TimeoutStartSec=0

KillMode=none

EnvironmentFile=/etc/environment

ExecStart=/bin/sh -c "while true; do etcdctl set /services/redis '${COREOS_PRIVATE_IPV4}':--ttl 60; echo setting etcd for redis, sleeping; sleep 45; done"
ExecStop=/usr/bin/etcdctl rm /services/redis 

[X-Fleet]
MachineOf=redis.service
